$(function(){function e(){c.hide().filter("[data-type=album]").show();var e=a.getAlbumList(),s="";for(var t in e)s+='<li><a href="javascript:;">'+t+"</a></li>";$(".js_album_list").empty().html(s)}function s(){c.hide().filter("[data-type=record]").show()}function t(e){var s=$(".js_opern"),t=a.getAlbumList(),n=a.getKeyboard(),i=t[e],r=i;if(r.length){for(var o=35,l=Math.ceil(r.length/o),d="",_=0;l>_;_++){var u=o*(_+1),j=tmp2="";_==l-1&&(u=r.length);for(var p=_*o;u>p;p++){var f=r[p];"0"==f?(j+='<dd class="empty-pat"></dd>',tmp2+='<dd class="empty-pat"></dd>'):(j+="8"==f||"9"==f?'<dd class="high-pat">'+(f-7)+"</dd>":"<dd>"+f+"</dd>",tmp2+="<dd>"+n[f]+"</dd>")}d+='<dl class="number"><dt>乐谱</dt>'+j+"</dl>",d+='<dl class="letter"><dt>键盘弹奏</dt>'+tmp2+"</dl>"}s.find(".title").html(e),s.find(".js_opern_info").html(d),c.hide().filter("[data-type=opern]").show()}}function n(e,s){var t=$(".js_tips");t.length&&t.remove();var n=e?"success":"error",i='<div class="js_tips mod-tips '+n+'">'+s+"</div>";$("body").append(i),setTimeout(function(){$(".js_tips").fadeOut(300)},3e3)}function i(){var e=$(".js_song_link")[0];if(e&&e.select){e.select();try{document.execCommand("copy"),n(!0,"复制链接成功，粘贴分享")}catch(s){n(!1,"浏览器不支持复制")}}}function r(e){var s=$(".js_menu li");s.eq(e-1).removeClass("on").addClass("on"),setTimeout(function(){s.eq(e-1).removeClass("on")},200)}function o(){var e="",s=encodeURIComponent($(".js_song_link").val()),t="分享钢琴节奏@轩枫Y_me",n="分享钢琴节奏",i="分享钢琴节奏@轩枫阁",r="分享钢琴节奏";$("body").snsShare({tsina:{url:s,title:t,pic:e},renren:{url:s,title:n,pic:e},tqq:{url:s,title:i,pic:e},tqzone:{url:s,title:r,pic:e}})}var a=new Piano({playKeyCallback:r}),c=$(".js_piano_pannel");$(".js_piano_nav_icon").on("click",function(){$("body");$("body").toggleClass("mod-piano"),$(this).toggleClass("close"),$(".js_piano").toggleClass("ui-d-n"),$(".js_piano_nav li").eq(0).trigger("click")}),$(".js_menu li").on("mouseover",function(){var e=$(this).index()+1;a.playKey(e),a.record(e)}),$(".js_piano_nav li").on("click",function(){$(this).siblings("li").removeClass("active").end().addClass("active");var t=$(this).data("type")||"album";switch(t){case"album":e();break;case"record":s();break;case"mine":renderMine()}}),$(".js_album_list").on("click","a",function(){"javascript:;"==$(this).attr("href")&&(t($(this).text()),c.filter("[data-type=record]").show())}),$(".js_show_album").on("click",function(){e()}),$(".js_start_record").on("click",function(){$(".js_start_record").addClass("ui-d-n"),$(".js_cancel_record, .js_finish_record").removeClass("ui-d-n"),$(".js_recore_text").text("正在录制，请使用鼠标或键盘弹奏"),a.startRecord()}),$(".js_finish_record").on("click",function(){var e=a.getStatus();e?($(".js_song_link").val(a.finishRecord()),$(".js_recore_success, .js_start_record").removeClass("ui-d-n"),$(".js_record_srea, .js_finish_record, .js_cancel_record").addClass("ui-d-n"),$(".js_recore_text").text("点击开始录制，可以把你弹奏的曲子录制下来"),o()):n(!1,"没有弹奏，请重新录制")}),$(".js_cancel_record").on("click",function(){$(".js_finish_record, .js_cancel_record").addClass("ui-d-n"),$(".js_start_record").removeClass("ui-d-n"),$(".js_recore_text").text("点击开始录制，可以录制弹奏的曲子")}),$(".js_preview_record").on("click",function(){var e=$(".js_song_link").val(),s=a.analysis(e);a.previewSong(s)}),$(".js_reset_record").on("click",function(){$(".js_record_srea").removeClass("ui-d-n"),$(".js_recore_success").addClass("ui-d-n")}),$(".js_upload_record").on("click",function(){var e=this;return $(".js_share_record").trigger("click"),setTimeout(function(){window.open($(e).attr("href"))},1500),!1}),$(".js_share_record").on("click",function(){i()}),$(".js_piano_nav_icon").click()});